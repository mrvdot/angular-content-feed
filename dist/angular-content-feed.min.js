!function(a){"use strict";a.module("mvd.contentFeed",["ngSanitize"]).provider("contentConfig",function(){var b={provider:null,pageSize:10,formatters:[],properties:{id:"id",content:"content"},cache:"contentCache"},c={};return this.setOptions=function(a){return c=a,this},this.setProvider=function(a){return c.provider=a,this},this.addFormatter=function(a){return c.formatters||(c.formatters=[]),c.formatters.push(a),this},this.$get=["$injector","$log",function(d,e){var f=a.extend({},b,c);if(!f.provider)throw"Must specify content provider before initializaing content";if(a.isString(f.provider)){if(!d.has(f.provider))throw'Specified provider "'+f.provider+'" not registered with injector';f.provider=d.get(f.provider)}if(a.isString(f.cache)?(d.has(f.cache)||(e.warn('Specified cache "'+f.cache+'" not registered with injector, using noop'),f.cache=d.get("noopCache")),f.cache=d.get(f.cache)):f.cache||(f.cache=d.get("noopCache")),f.formatters)for(var g=0,h=f.formatters.length;h>g;g++){var i=f.formatters[g];a.isString(i)&&(d.has(i)?f.formatters[g]=d.get(i):d.has(i+"Filter")?f.formatters[g]=d.get(i+"Filter"):(e.warn("unknown formatter",i,"replacing with identity"),f.formatters[g]=a.identity))}return f}],this}).factory("noopCache",function(){return{setRaw:a.noop,getRaw:a.noop,set:a.noop,get:function(a,b,c,d){return b(a,c,d)}}}).factory("contentCache",["$q","$cacheFactory",function(b,c){var d=c("contentCache"),e={},f=function(a,b,c){if(e[a]&&e[a].length)for(var d=e[a].splice(0,Number.MAX_VALUE),f=0,g=d.length;g>f;f++){var h=d[f];b?h.resolve(b):h.reject(c)}},g=function(b){return a.isString(b)?b:a.toJson(b)};return{setRaw:function(a,b){var c=g(a);return d.put(c,b),this},getRaw:function(a){var b=g(a),c=d.get(b);return c},set:function(a,b){var c=g(a);return this.setRaw(c,b),this},get:function(a,c,d,h){var i,j=g(a),k=b.defer();return k.promise.then(d,h),e[j]||(e[j]=[]),e[j].push(k),(i=this.getRaw(j))?i:(i=c(a,function(a){f(j,a)},function(a){f(j,null,a)}),this.set(j,i),i)}}}]).factory("content",["contentConfig","$timeout",function(b,c){var d,e=b.provider,f=b.cache,g=[].slice,h=function(c){var d={limit:b.pageSize};return c?a.extend(d,c):d},i=function(b){return b||(b=a.noop),function(){var a=g.call(arguments,0),d=this;c(function(){b.apply(d,a)})}};return{get:function(a,b,c){var g=f.getRaw(a);if(g)return d=g,b&&i(b)(g),g;var h;return h=e.get.bind?e.get.bind(e):e.get,g=f.get(a,h,i(b),i(c)),d=g,g},current:function(){return d},feed:function(a,b,c){var a=h(a),d=f.getRaw(a);return d?(b&&i(b)(d),d):f.get(a,e.load.bind(e),i(b),i(c))}}}]).directive("content",["content",function(a){return{scope:!0,link:function(b){b.feed=a.feed()}}}]).directive("contentElement",["contentConfig",function(a){return{scope:!0,link:function(b,c,d){if(a.formatters.length){var e=function(b){if(!b)return b;for(var c=a.formatters,d=0,e=c.length;e>d;d++){var f=c[d];if(b=f(b),"undefined"==typeof b)break}return b};b.$watch(d.contentElement+"."+a.properties.content,function(a){b.$formattedContent=e(a)})}}}}])}(angular);